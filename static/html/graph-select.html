<html>
  <head>
    <script src="/static/js/jquery-1.11.1.min.js"></script>
    <link rel="stylesheet" href="/static/css/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" href="/static/css/ig.css" />
  </head>
  <body>
    <div id="row3" class="row"> 
      <div id="ig-graphsel-buttonholder" class="ig-graphsel-buttonholder">
	<button id="graphsel-button" class="ig-graphsel-button" type="button">View</button>
      </div> 
    </div>
  </body>
  <script>
    $(document).ready(function () {

	$('#row3').appendTo($('#container1'))

	var selectedCount = 0;

	function enableViewButton(){
	    $('.ig-graphsel-button').prop("disabled", false);
	}

	function disableViewButton(){
	    $('.ig-graphsel-button').prop("disabled", true);
	}


	/**
	 * Method for when a graph selector is selected.
	 * @param {Element | Object} graphElt The graph selector as an element
	 *    or jQuery object.
	 */
	function onGraphSelectorSelected(graphSelector){
	    $(graphSelector).data('selected', true);
	    $(graphSelector).addClass("ig-selected");
	    selectedCount++;
	    enableViewButton();
	}


	/**
	 * Method for when a graph selector is deselected.
	 * @param {Element | Object} graphElt The graph selector as an element
	 *    or jQuery object.
	 */
	function onGraphSelectorDeselected(graphSelector){
	    $(graphSelector).data('selected', false);
	    $(graphSelector).removeClass("ig-selected");
	    selectedCount--;
	    // Disable View Button if there are no selected
	    if (selectedCount == 0) {
		disableViewButton();
	    }
	}



	//
	// Add grapholders
	//
	$("#row2").append($(".ig-graphholder"));

	//
	// Disable View button by default
	//
	disableViewButton();

	//
	// Apply select stylings
	//
	$('.ig-graphsel').data('selected', false);
	$('.ig-graphsel').click(function() {
	    if ($(this).data('selected') === false){
		onGraphSelectorSelected(this);
	    } else {
		onGraphSelectorDeselected(this);
	    }
	});


	//
	// View button click
	//
	$('.ig-graphsel-button').click(function() {
	    var selector;
	    var urlAppend = '?' + '{{.QueryPrefix}}' + '=';
	    $.each($('.ig-graphsel'), function(key, gs){
		selector = $(gs);
		if (selector.data("selected") === true){
		    urlAppend += selector.attr('ig-query') + '&';
		}
	    })

	    // Launch the graphs!!
	    window.open({{.Display}} + urlAppend.slice(0,-1), '_blank');
	});		
    });
    
  </script>
</html>
