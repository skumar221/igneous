<html>
  <head>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/flot/0.8.2/jquery.flot.min.js"></script>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" href="/static/css/ig.css" />
  </head>
  <body>
    
   
      <div id="container1" class="ig-container container">
	<div id="row1" class="row show-grid">
	  <div id="ig-logo-container" class="ig-logo-container">
	    <img id="ig-logo" class="ig-logo-image" src="/static/images/logos/igneous-logo.png"></img>
	  </div>
	</div>
	
	<div id="row2" class="row show-grid"></div>
      </div>


  </body>
  <script>
    $(document).ready(function () {

	function createGraph(graphJson){
	    window.console.log("APPENDING");
	    var d = document.createElement('div');
	    d.setAttribute("id", "graph-wrapper-" + graphJson.Query)
	    $(d).addClass('ig-graph col-md-1').appendTo("#row2");
	    /*
	    $(d).html(//'<div class="graph-info">' + 
		      //'<a href="javascript:void(0)" class="visitors ig-font">Hour</a>' +
		      //'<a href="javascript:void(0)" class="returning ig-font">Week</a>' +
		      //'<a href="#" id="bars"><span></span></a>' +
		      //'<a href="#" id="lines" class="active"><span></span></a>' +
		      //'</div>' +
		      //'<div class="graph-container-' +  graphJson.Query + '">' +
		      '<div id="ig-graph-lines-' +  graphJson.Query + '"></div>' +
		      //'</div>')
		      */

	    $.each(['ig-graph-lines-week'], function(key, val){
		jQuery('<div/>', {
		    id: val + '-' +  graphJson.Query,
		}).appendTo(d).addClass(val);		
	    })
	    return $(d)
	}

	
	//
	// GET request for the graph data using the REST API
	//
	var jsonUrl = "/system-performance-data/"
	if (document.URL.indexOf('?kind') > -1){
	    jsonUrl +="?" + document.URL.split('?')[1];
	}


	function showTooltip(x, y, contents) {
	    $('<div id="tooltip">' + contents + '</div>').css({
		top: y - 16,
		left: x + 20
	    }).appendTo('body').fadeIn();
	}

	$.getJSON(jsonUrl, function( data ) {
	    $.each(data, function(key, graphJson){

		graph = createGraph(graphJson);
		var graphData = [{
		    // Visits
		    data: graphJson.Data,
		    color: graphJson.Color
		}];

		$.plot($("#ig-graph-lines-week-" + graphJson.Query), graphData, {
		    series: {
			points: {
			    show: true,
			    radius: 2
			},
			lines: {
			    show: true
			},
			shadowSize: 0
		    },
		    grid: {
			color: '#646464',
			borderWidth: 1,
			hoverable: true
		    },
		});


		var previousPoint = null;
		
		$("<div id='tooltip'></div>").css({
		    position: "absolute",
		    display: "none",
		    border: "1px solid #fdd",
		    padding: "2px",
		    "background-color": "#fee",
		    opacity: 0.80
		}).appendTo("body");


		$("#ig-graph-lines-week-" + graphJson.Query).bind('plothover', function (event, pos, item) {
		    if (item) {
			var x = item.datapoint[0].toFixed(2),
			y = item.datapoint[1].toFixed(2);
			
			$("#tooltip").html(item.series.label + " of " + x + " = " + y)
			    .css({top: item.pageY+5, left: item.pageX+5})
			    .fadeIn(200);
		    } else {
			$("#tooltip").hide();
		    }
		});


		//$.plot($("#ig-graph-lines-hour-" + graphJson.Query), graphData);
	    })	    
	});		
    });
    
  </script>
</html>
